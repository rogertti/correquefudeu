/*jslint browser: true*/
/*jslint node: true*/
/*jslint browser: true*/
/*global $, jQuery, alert, btoa*/

"use strict";

$(document).ready(function () {
    var fade = 150;

    /* MODAL */

    $(".close,.closed").click(function () {
        location.reload();
    });

    /* INSTALAÇÃO */

    $(".form-install").submit(function (e) {
        e.preventDefault();

        var senha_banco = btoa($("#senha_banco").val()), usuario = btoa($("#usuario").val()), senha = btoa($("#senha").val());

	    $.post("commitAplicativo.php", { servidor: $("#servidor").val(), banco: $("#banco").val(), usuario_banco: $("#usuario_banco").val(), senha_banco: senha_banco, nome: $("#nome").val(), usuario: usuario, senha: senha, email: $("#email").val(), rand: Math.random()}, function (data) {
            $(".btn-submit-install").html('<img src="img/rings.svg" class="loader-svg">').fadeTo(fade, 1);

            switch (data) {
            case 'true':
                $.smkAlert({text: 'A instala&ccedil;&atilde;o foi feita com sucesso.', type: 'success', time: 1});
                window.setTimeout("location.href='index'", 1000);
                break;

            default:
                $.smkAlert({text: data, type: 'warning', time: 3});
                break;
            }

            $(".btn-submit-install").html('Entrar').fadeTo(fade, 1);
        });

	    return false;
    });

    /* LOGIN */

    $(".form-login").submit(function (e) {
        e.preventDefault();

        var usuario = btoa($("#usuario").val()), senha = btoa($("#senha").val());

	    $.post("trustLogin.php", { usuario: usuario, senha: senha, rand: Math.random()}, function (data) {
            $(".btn-submit-login").html('<img src="img/rings.svg" class="loader-svg">').fadeTo(fade, 1);

            switch (data) {
            case 'true':
                $.smkAlert({text: 'Ok! Redirecionando...', type: 'success', time: 1});
                window.setTimeout("location.href='inicio'", 1000);
                break;

            default:
                $.smkAlert({text: data, type: 'warning', time: 3});
                break;
            }

            $(".btn-submit-login").html('Entrar').fadeTo(fade, 1);
        });

	    return false;
    });

    /* RECUPERAR SENHA */

    $(".form-recupera-senha").submit(function (e) {
        e.preventDefault();

	    $.post("recoverSenha.php", { email: $("#email").val(), rand: Math.random()}, function (data) {
            $(".btn-submit-recover").html('<img src="img/rings.svg" class="loader-svg">').fadeTo(fade, 1);

            switch (data) {
            case 'true':
                $.smkAlert({text: 'A senha foi enviada para o seu email.', type: 'success', time: 2});
                window.setTimeout("location.href='index'", 2000);
                break;

            default:
                $.smkAlert({text: data, type: 'warning', time: 3});
                break;
            }

            $(".btn-submit-recover").html('Recuperar').fadeTo(fade, 1);
        });

	    return false;
    });

    /* EDITA AUTOR */

    $(".form-edita-autor").submit(function (e) {
        e.preventDefault();

        var usuario = btoa($("#usuario-").val()), senha = btoa($("#senha-").val());

	    $.post("updateAutor.php", { idautor: $("#idautor").val(), nome: $("#nome-").val(), usuario: usuario, senha: senha, email: $("#email-").val(), rand: Math.random()}, function (data) {
            $(".btn-submit-edita-autor").html('<img src="img/rings.svg" class="loader-svg">').fadeTo(fade, 1);

            switch (data) {
            case 'true':
                $.smkAlert({text: 'Dados do autor editado com sucesso.', type: 'success', time: 2});
                window.setTimeout("location.href='autor'", 2000);
                break;

            default:
                $.smkAlert({text: data, type: 'warning', time: 3});
                break;
            }

            $(".btn-submit-edita-autor").html('Salvar').fadeTo(fade, 1);
        });

	    return false;
    });

    /* EDITA REDE SOCIAL */

    $(".form-edita-social").submit(function (e) {
        e.preventDefault();

	    $.post("updateSocial.php", { idsocial: $("#idsocial").val(), rede: $("#rede-").val(), url: $("#url-").val(), rand: Math.random()}, function (data) {
            $(".btn-submit-edita-social").html('<img src="img/rings.svg" class="loader-svg">').fadeTo(fade, 1);

            switch (data) {
            case 'true':
                $.smkAlert({text: 'Rede social editada com sucesso.', type: 'success', time: 2});
                window.setTimeout("location.href='social'", 2000);
                break;

            default:
                $.smkAlert({text: data, type: 'warning', time: 3});
                break;
            }

            $(".btn-submit-edita-social").html('Salvar').fadeTo(fade, 1);
        });

	    return false;
    });

    /* EDITA TAG */

    $(".form-edita-tag").submit(function (e) {
        e.preventDefault();

	    $.post("updateTag.php", { idtag: $("#idtag").val(), descricao: $("#descricao-").val(), rand: Math.random()}, function (data) {
            $(".btn-submit-edita-tag").html('<img src="img/rings.svg" class="loader-svg">').fadeTo(fade, 1);

            switch (data) {
            case 'true':
                $.smkAlert({text: 'Tag editada com sucesso.', type: 'success', time: 2});
                window.setTimeout("location.href='tag'", 2000);
                break;

            default:
                $.smkAlert({text: data, type: 'warning', time: 3});
                break;
            }

            $(".btn-submit-edita-tag").html('Salvar').fadeTo(fade, 1);
        });

	    return false;
    });
});
